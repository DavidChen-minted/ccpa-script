<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/ccpa-script/_next/static/tg7k_JYXJ8aE1Gha4bPWt/pages/_app.js" as="script"/><link rel="preload" href="/ccpa-script/_next/static/tg7k_JYXJ8aE1Gha4bPWt/pages/%5Baspect%5D.js" as="script"/><link rel="preload" href="/ccpa-script/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/ccpa-script/_next/static/chunks/framework.c8d289f8b96717e32d7a.js" as="script"/><link rel="preload" href="/ccpa-script/_next/static/chunks/89f4c383c411074db7645b026ed6af4ec9f6bb4a.1f32dc84b2a7423250f8.js" as="script"/><link rel="preload" href="/ccpa-script/_next/static/chunks/f41885cb67ddbacf697a564daa04b9b3e91e4310.b50a31b9e106c2488862.js" as="script"/><link rel="preload" href="/ccpa-script/_next/static/chunks/95efd3ec87daf9ac2edc1801913bbd21a155bb40.4a2e827e9938d08b2ced.js" as="script"/><link rel="preload" href="/ccpa-script/_next/static/runtime/main-4f2041002797547d8f6a.js" as="script"/><link rel="preload" href="/ccpa-script/_next/static/chunks/70cb7738df70b824ebbe9d4061fa610285e3b60e.8ad621c7809f0cf769a3.js" as="script"/></head><body><div id="__next"><style data-emotion-css="x4uzf6">{box-sizing:border-box;}button{border:none;border-radius:0;margin:0;padding:0;width:auto;overflow:visible;background:transparent;}button:focus{outline:none;box-shadow:none;}</style><main><style data-emotion-css="1ek5umn">.css-1ek5umn{font-size:1.875rem;text-transform:capitalize;}</style><h1 class="css-1ek5umn">growth CCPA script</h1><style data-emotion-css="4y9tky">.css-4y9tky{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;height:calc(0rem - 1.25rem);margin:1.25rem 0 1.25rem;}</style><div class="css-4y9tky"><style data-emotion-css="j0x1t">.css-j0x1t{max-width:25rem;width:25%;border-right:0.0625rem solid black;margin-right:0.625rem;}</style><div class="css-j0x1t"><div><style data-emotion-css="41fam1">.css-41fam1{display:block;color:black;font-size:1.25rem;text-align:center;font-family:inherit;text-transform:uppercase;cursor:pointer;margin:0.625rem auto;-webkit-transition:left 250ms ease-in-out;transition:left 250ms ease-in-out;}.css-41fam1:hover{color:gray;position:relative;}.css-41fam1:hover{left:-0.3125rem;}</style><button type="button" class="css-41fam1">Steps ◀</button></div><style data-emotion-css="196vcl3">.css-196vcl3{width:calc(100% - 2 * 0.3125rem);border-top:0.0625rem solid black;margin:0.3125rem;}</style><div class="css-196vcl3"></div><style data-emotion-css="s5rw7l">.css-s5rw7l{margin:0.625rem;margin-bottom:1.25rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;overflow:hidden;overflow-y:auto;max-height:calc(0rem - 1.25rem);}</style><div class="css-s5rw7l"></div></div><style data-emotion-css="8atqhb">.css-8atqhb{width:100%;}</style><div class="css-8atqhb"><style data-emotion-css="uudpsy">.css-uudpsy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-uudpsy"><style data-emotion-css="vr7ngo">.css-vr7ngo{margin-bottom:0.625rem;}</style><div class="css-vr7ngo"><style data-emotion-css="104ogo0">.css-104ogo0{font-size:0.875rem;margin:0.25rem;font-family:inherit;font-weight:bold;font-weight:normal;text-align:left;color:blue;cursor:pointer;}.css-104ogo0:hover{color:red;}</style><button type="button" class="css-104ogo0">△ </button><style data-emotion-css="4f93re">.css-4f93re{font-size:1.25rem;margin:0.25rem;font-family:inherit;font-weight:bold;}</style><div class="css-4f93re"></div><button type="button" class="css-104ogo0">▽ </button></div><style data-emotion-css="riq1e4">.css-riq1e4{display:grid;grid-auto-flow:column;grid-template-rows:repeat(3,auto);height:6.25rem;}</style><div class="css-riq1e4"></div></div><style data-emotion-css="1m899m5">.css-1m899m5{width:100%;margin:0.625rem 0;}</style><div class="css-1m899m5"><style data-emotion-css="womqhu">.css-womqhu{font-size:1.25rem;text-align:left;}</style><h2 class="css-womqhu"></h2><div></div></div><style data-emotion-css="1homj8q">.css-1homj8q{display:grid;grid-template-columns:repeat(1,1fr);grid-template-rows:repeat(3,auto);justify-items:stretch;-webkit-column-gap:0.9375rem;column-gap:0.9375rem;row-gap:0.3125rem;}</style><div class="css-1homj8q"></div></div><style data-emotion-css="1q1ou2n">.css-1q1ou2n{max-width:31.25rem;width:30%;border-left:0.0625rem solid black;margin-left:0.625rem;}</style><div class="css-1q1ou2n"><div><style data-emotion-css="ygrs7q">.css-ygrs7q{display:block;color:black;font-size:1.25rem;text-align:center;font-family:inherit;text-transform:uppercase;cursor:pointer;margin:0.625rem auto;-webkit-transition:left 250ms ease-in-out;transition:left 250ms ease-in-out;}.css-ygrs7q:hover{color:gray;position:relative;}.css-ygrs7q:hover{left:0.3125rem;}</style><button type="button" class="css-ygrs7q">▶ result</button></div><div class="css-196vcl3"></div><div><div><style data-emotion-css="1rhkm9m">.css-1rhkm9m{font-size:1rem;margin:0.625rem auto 0.9375rem;display:block;cursor:pointer;outline:none;text-transform:capitalize;}</style><select class="css-1rhkm9m"><option selected="" value="notes">notes</option></select></div><div></div></div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"initialProps":{"appProps":{}},"initialState":{"scriptSnippet":{"ids":[],"entities":{}},"variable":{"ids":[],"entities":{}},"scriptType":[],"scriptDatabase":[],"choiceControl":{"ids":[],"entities":{}},"step":{"steps":{}},"databaseScript":{"scripts":{}},"notes":{"ids":[],"entities":{}},"scriptResult":{"ids":[],"entities":{}}},"__N_SSG":true,"pageProps":{"yamlData":{"steps":[{"id":"begin","check":{"script":{"db":"drupal","snippets":["set_email_var"]}},"delete":{"script":{"db":"drupal","snippets":["set_request_number","set_user_id_var","compose_email_placeholder","compose_text_placeholder"]}}},{"id":"users","check":{"description":"check if the email is in users table in bidata DB\n","script":{"db":"drupal","snippets":["set_email_var","find_user_id","show_user_id"]}},"delete":{"description":"create sql to \"delete\" in users table\n","script":{"db":"drupal","snippets":["update_placeholder_in_users"]}}},{"id":"sessions","check":{"description":"check if the user id is in sessions table in sessions DB\n","script":{"db":"sessions","snippets":["set_user_id_var","find_sessions"]}}},{"id":"friend_email","check":{"description":"check if the email is in friend_email table in bidata DB\n","script":{"db":"drupal","snippets":["set_email_var","find_friend_email_id","find_friend_email"]}}},{"id":"friend_address","check":{"description":"check if the friend email id is in friend_address table in bidata DB\n","script":{"db":"drupal","snippets":["set_email_var","find_friend_email_id","find_friend_address_id","find_friend_address"]}}},{"id":"minted_account","check":{"description":"check if the user id is in minted_account table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_account"]}}},{"id":"minted_order_incomplete","check":{"description":"check if the user id is in minted_order table in bidata DB and  order has been placed and NOT completed\n","choices":[{"id":"yes","notes":"TODO: We need to wait for the order to be completed  before we delete data\n"},{"id":"no"}],"script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_incomplete"]}}},{"id":"minted_order_complete","check":{"description":"check if the user id is in minted_order table in bidata DB and  order has been placed, completed, and not passed the return policy,  3 months after purchase\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_complete"]}}},{"id":"minted_order_digital","check":{"dependency":{"id":"minted_order_complete","choice":"yes","type":"check"},"description":"check if the minted_order_line_item is digital\n","choices":[{"id":"yes"},{"id":"no","notes":"TODO: We need to wait for the return policy to pass before we delete data\n"}],"script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_digital"]}}}],"types":["check","delete","Validation"],"db":["drupal","sessions","di","jobs","di_jobs"],"vars":{"email":{"description":"email address from OneTrust\n"},"requestNumber":{"description":"request number from OneTrust\n"},"userId":{"description":"user id from the main drupal database\n"},"emailPlaceholder":{"description":"placeholder to replace email reference\n"},"textPlaceholder":{"description":"placeholder to replace text reference\n"}},"snippets":{"set_email_var":"set @email = {{email}};\n","find_user_id":"select uid into @UID from users where mail = @email;\n","show_user_id":"select @UID;\n","set_request_number":"set @requestnumber = {{requestNumber}};\n","set_user_id_var":"set @UID = {{userId}};\n","compose_email_placeholder":"select concat(\"deleted-onetrust-req-\", @requestnumber, \"@privacy.mntd.net\") into @emailplaceholder;\n","compose_text_placeholder":"select concat(\"Deleted per onetrust\", @requestnumber) into @textplaceholder;\n","update_placeholder_in_users":"update users\nset\nname = @textplaceholder,\ninit = @textplaceholder,\nmail = @emailplaceholder,\npass = textplaceholder,\nwhere uid = @UID;\n","find_sessions":"select * from sessions where uid = @UID;\n","find_friend_email_id":"select id into @friendemailid from friend_email where email = @email;\n","find_friend_email":"select * from friend_email where id = @friendemailid;\n","find_friend_address_id":"select friend_address_id into @friend_address_id\nfrom friend_email where id = @friendemailid;\n","find_friend_address":"select * from friend_address where id = @friendaddressid;\n","find_minted_account":"select * from minted_account where user_id = @UID;\n","find_minted_order_incomplete":"select *\nfrom minted_order\nwhere owner_id = @UID\nand is_placed = 1\nand minted_state_diagram_state_id \u003c\u003e 150;\n","find_minted_order_complete":"select *\nfrom minted_order\nwhere owner_id = @UID\nand is_placed = 1\nand minted_state_diagram_state_id = 150\nand date_add(order_placement_date, interval 3 month) \u003e= now();\n","find_minted_order_digital":"select moli.*\nfrom minted_order mo\ninner join minted_order_line_item moli\non mo.id = moli.minted_order_id\nand moli.line_item_type = 'product'\nwhere owner_id = @UID\nand is_placed = 1\nand minted_state_diagram_state_id = 150\nand date_add(order_placement_date, interval 3 month) \u003e= now();\n"}},"aspect":"growth"}},"page":"/[aspect]","query":{"aspect":"growth"},"buildId":"tg7k_JYXJ8aE1Gha4bPWt","assetPrefix":"/ccpa-script","runtimeConfig":{},"nextExport":false,"isFallback":false,"gsp":true,"appGip":true}</script><script nomodule="" src="/ccpa-script/_next/static/runtime/polyfills-f1a72475392243fcf9b5.js"></script><script async="" data-next-page="/_app" src="/ccpa-script/_next/static/tg7k_JYXJ8aE1Gha4bPWt/pages/_app.js"></script><script async="" data-next-page="/[aspect]" src="/ccpa-script/_next/static/tg7k_JYXJ8aE1Gha4bPWt/pages/%5Baspect%5D.js"></script><script src="/ccpa-script/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/ccpa-script/_next/static/chunks/framework.c8d289f8b96717e32d7a.js" async=""></script><script src="/ccpa-script/_next/static/chunks/89f4c383c411074db7645b026ed6af4ec9f6bb4a.1f32dc84b2a7423250f8.js" async=""></script><script src="/ccpa-script/_next/static/chunks/f41885cb67ddbacf697a564daa04b9b3e91e4310.b50a31b9e106c2488862.js" async=""></script><script src="/ccpa-script/_next/static/chunks/95efd3ec87daf9ac2edc1801913bbd21a155bb40.4a2e827e9938d08b2ced.js" async=""></script><script src="/ccpa-script/_next/static/runtime/main-4f2041002797547d8f6a.js" async=""></script><script src="/ccpa-script/_next/static/chunks/70cb7738df70b824ebbe9d4061fa610285e3b60e.8ad621c7809f0cf769a3.js" async=""></script><script src="/ccpa-script/_next/static/tg7k_JYXJ8aE1Gha4bPWt/_buildManifest.js" async=""></script><script src="/ccpa-script/_next/static/tg7k_JYXJ8aE1Gha4bPWt/_ssgManifest.js" async=""></script></body></html>
{"initialProps":{"appProps":{}},"initialState":{"scriptSnippet":{"ids":[],"entities":{}},"variable":{"ids":[],"entities":{}},"scriptType":[],"scriptDatabase":[],"choiceControl":{"ids":[],"entities":{}},"step":{"steps":{}},"databaseScript":{"scripts":{}},"notes":{"ids":[],"entities":{}},"scriptResult":{"ids":[],"entities":{}},"dependencyCheck":{"dependencyChecks":{}}},"__N_SSG":true,"pageProps":{"yamlData":{"steps":[{"id":"begin_drupal","check":{"script":{"db":"drupal","snippets":["set_email_var"]}},"delete":{"script":{"db":"drupal","snippets":["set_request_number_var","set_user_id_var","compose_email_placeholder","compose_text_placeholder"]}},"validation":{"script":{"db":"drupal","snippets":["set_request_number_var","set_user_id_var","compose_email_placeholder","compose_text_placeholder"]}}},{"id":"users","check":{"description":"check if the email is in users table in bidata DB\n","script":{"db":"drupal","snippets":["set_email_var","find_user_id","show_user_id"]}},"delete":{"description":"create sql to \"delete\" in users table\n","script":{"db":"drupal","snippets":["update_placeholder_in_users"]}},"validation":{"description":"create sql to verify \"deletions\" in users\n","script":{"db":"drupal","snippets":["validate_users_placeholder"]}}},{"id":"sessions","check":{"description":"check if the user id is in sessions table in sessions DB\n","script":{"db":"sessions","snippets":["set_user_id_var","find_sessions"]}},"delete":{"description":"create sql to delete rows in sessions table\n","script":{"db":"sessions","snippets":["delete_sessions"]}}},{"id":"friend_email","check":{"description":"check if the email is in friend_email table in bidata DB\n","script":{"db":"drupal","snippets":["set_email_var","find_friend_email_id_list"]}},"delete":{"description":"create sql to \"delete\" in friend_email\n","script":{"db":"drupal","snippets":["update_placeholder_in_friend_email"]}},"validation":{"description":"create sql to verify \"deletion\" in friend_email\n","script":{"db":"drupal","snippets":["validate_friend_email_placeholder"]}}},{"id":"friend_address","check":{"description":"check if the friend email id is in friend_address table in bidata DB\n","script":{"db":"drupal","snippets":["find_friend_address"]}}},{"id":"minted_account","check":{"description":"check if the user id is in minted_account table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_account"]}},"delete":{"description":"create sql to \"delete\" in minted_account\n","script":{"db":"drupal","snippets":["update_placeholder_in_minted_account"]}},"validation":{"description":"create sql to verify \"deletion\" in minted_account\n","script":{"db":"drupal","snippets":["validate_minted_account_placeholder"]}}},{"id":"minted_order_incomplete","check":{"description":"check if the user id is in minted_order table in bidata DB and  order has been placed and NOT completed\n","choices":[{"id":"yes","notes":"TODO: We need to wait for the order to be completed  before we delete data\n"},"no"],"script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_incomplete"]}}},{"id":"minted_order_complete_within_3_months","check":{"description":"check if the user id is in minted_order table in bidata DB and  order has been placed, completed, and not passed the return policy,  3 months after purchase\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_complete_within_3_months"]}}},{"id":"minted_order_digital","check":{"dependency":[{"stepId":"minted_order_complete_within_3_months","choice":"yes","type":"check"}],"description":"check if the minted_order_line_item is digital\n","choices":["yes",{"id":"no","notes":"TODO: We need to wait for the return policy to pass before we delete data\n"}],"script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_digital"]}}},{"id":"minted_order_complete_3_months_before","check":{"description":"check if the user id is in minted_order table in bidata DB and order has been placed, completed,  and passed the return policy, 3 months after purchase\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_complete_3_months_before"]}},"delete":{"description":"create sql to \"delete\" in minted_order\n","script":{"db":"drupal","snippets":["update_placeholder_in_minted_order"]}},"validation":{"description":"create sql to verify \"deletion\" in minted_order\n","script":{"db":"drupal","snippets":["valdiate_minted_order_placeholder"]}}},{"id":"minted_order_line_item","check":{"description":"check if the user id is in minted_order_line_item table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_line_item"]}},"delete":{"description":"create sql to \"delete\" in minted_order_line_item\n","script":{"db":"drupal","snippets":["update_placeholder_in_minted_order_line_item"]}},"validation":{"description":"create sql to verify \"deletion\" in minted_order_line_item\n","script":{"db":"drupal","snippets":["validate_minted_order_line_item_placeholder"]}}},{"id":"thumbnail_in_minted_order_line_item","check":{"description":"check if updated_thumbnail_url is in minted_order_line_item\n","choices":[{"id":"yes","notes":"TODO: Download the appropriate asset  https://minted.atlassian.net/wiki/spaces/EN/pages/253427737/Taking+inventory+of+PII+and+preparing+for+CCPA+requests#Placeholder-assets  Go to the appropriate bucket in S3 and file. Replace the file with the asset you just downloaded.\n"},"no"],"script":{"db":"drupal","snippets":["find_thumbnail_url_in_minted_order_line_item"]}}},{"id":"price_adjustment_note","check":{"description":"check if the user id is in price_adjustment_note table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_price_adjustment_note"]}},"delete":{"description":"create sql to \"delete\" in price_adjustment_note only after all orders are completed and passed the return policy\n","script":{"db":"drupal","snippets":["update_placeholder_in_price_adjustment_note"]}},"validation":{"description":"create sql to verify \"deletion\" in price_adjustment_note\n","script":{"db":"drupal","snippets":["validate_price_adjustment_note_placeholder"]}}},{"id":"payment_information","check":{"description":"check if the user id is in payment_information table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_payment_information"]}},"delete":{"description":"create sql to \"delete\" in payment_information only after all orders are completed and passed the return policy\n","script":{"db":"drupal","snippets":["update_placeholder_in_payment_information"]}},"validation":{"description":"create sql to verify \"deletion\" in payment_information\n","script":{"db":"drupal","snippets":["validate_payment_information_placeholder"]}}},{"id":"minted_address","check":{"description":"check if the user id is in minted_address table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_address"]}},"delete":{"description":"create sql to \"delete\" in minted_address only after all orders are completed and passed the return policy\n","script":{"db":"drupal","snippets":["update_placeholder_in_minted_address"]},"dependency":[{"stepId":"minted_order_incomplete","choice":"no","type":"check"}]},"validation":{"description":"create sql to verify \"deletion\" in minted_address\n","script":{"db":"drupal","snippets":["validate_minted_address_placeholder"]}}},{"id":"begin_di","check":{"script":{"db":"di","snippets":["set_email_var_unicode"]}},"delete":{"script":{"db":"di","snippets":["set_request_number_var","compose_email_placeholder","compose_text_placeholder"]}}},{"id":"di_unsubscribe_as_host","check":{"description":"check if the email is in di_unsubscribe table in DI DB as a host\n","script":{"db":"di","snippets":["set_email_var_unicode","find_di_unsubscribe_host","show_di_unsubscribe_host_id"]}}},{"id":"di_unsubscribe_as_guest","check":{"description":"check if the email is in di_unsubscribe table in DI DB as a guest\n","script":{"db":"di","snippets":["set_email_var_unicode","find_di_unsubscribe_guest","show_di_unsubscribe_guest_id"]}}},{"id":"di_invitation","check":{"description":"check if the invitation id is in di_invitation table in DI DB as a guest\n","script":{"db":"di","snippets":["set_email_var_unicode","find_di_invitation_id_list"]}},"delete":{"description":"create sql to \"delete\" in di_invitation\n","script":{"db":"di","snippets":["update_placeholder_in_di_invitation"]}},"validation":{"description":"create sql to verify \"deletion\" in di_invitation in DI DB","script":{"db":"di","snippets":["validate_di_invitation_placeholder"]}}},{"id":"di_event_poll_question_response","check":{"description":"check if the invitation id is in di_event_poll_question_response table in DI DB as a guest\n","script":{"db":"di","snippets":["find_di_event_poll_question_response"]}}},{"id":"email_in_di_host_test_email","check":{"description":"check if the email is in di_host_test_email table in DI DB\n","script":{"db":"di","snippets":["set_email_var_unicode","find_email_in_di_host_test_email"]}}},{"id":"di_email_as_guest","check":{"description":"check if the event id is in di_email table in DI DB as a guest\n","script":{"db":"di","snippets":["set_email_var_unicode","find_di_email_id_list_guest"]}},"delete":{"description":"create sql to delete from di_email as a guest\n","script":{"db":"di","snippets":["delete_di_email_as_guest"]}},"validation":{"description":"create sql to verify deletion in di_email in DI DB\n","script":{"db":"di","snippets":["validate_di_email_as_guest_deletion"]}}},{"id":"di_event_as_host","check":{"description":"check if the user id is in di_event table in DI DB as a host\n","script":{"db":"di","snippets":["set_user_id_var","find_di_event_id_list"]}}},{"id":"di_email_as_host","check":{"description":"check if the event id is in di_email table in DI DB as a host\n","script":{"db":"di","snippets":["find_di_email_host"]}}},{"id":"di_event_attribute","check":{"description":"check if the event id is in di_event_attribute table in DI DB\n","script":{"db":"di","snippets":["find_di_event_attribute"]}}},{"id":"di_event_comment","check":{"description":"check if the event id is in di_event_comment table in DI DB\n","script":{"db":"di","snippets":["find_di_event_comment"]}}},{"id":"di_event_message","check":{"description":"check if the event id is in di_event_message table in DI DB\n","script":{"db":"di","snippets":["find_di_event_message"]}}},{"id":"di_event_poll_question","check":{"description":"check if the event id is in di_event_poll_question table in DI DB\n","script":{"db":"di","snippets":["find_di_event_poll_question"]}}},{"id":"di_event_update_event","check":{"description":"check if the event id is in di_event_update_event table in DI DB\n","script":{"db":"di","snippets":["find_di_event_update_event"]}}},{"id":"event_id_in_di_host_test_email","check":{"description":"check if the event id is in di_host_test_email table in DI DB\n","script":{"db":"di","snippets":["find_event_id_in_di_host_test_email"]}}},{"id":"di_media","check":{"description":"check if the event id is in di_media table in DI DB\n","script":{"db":"di","snippets":["find_di_media"]}}},{"id":"transactional_email","check":{"description":"check if the email is in transactional email jobs table\n","script":{"db":"jobs","snippets":["set_email_like_var","find_job_id_for_email_in_job"]}},"delete":{"description":"create sql to delete from jobs table\n","script":{"db":"jobs","snippets":["delete_job_for_job_id_in_jobs"]}}},{"id":"di_jobs","check":{"description":"check if the email is in DI jobs table\n","script":{"db":"di_jobs","snippets":["set_email_like_var","find_job_id_for_email_in_job"]}},"delete":{"description":"create sql to delete from DI jobs table\n","script":{"db":"di_jobs","snippets":["delete_job_for_job_id_in_di_jobs"]}}}],"types":["check","delete","validation"],"db":["drupal","sessions","di","jobs","di_jobs"],"vars":{"email":{"description":"email address from OneTrust\n"},"requestNumber":{"description":"request number from OneTrust\n"},"userId":{"description":"user id from the main drupal database\n"},"friendEmailIdList":{"description":"friend email id list from the main drupal database\n"},"mintedOrderIdList":{"description":"minted order id list that is safe to modify\n"},"diEmailIdList":{"description":"di email id as guest list from di database\n"},"diInvitationIdList":{"description":"di invitation id list from di database\n"},"diEventIdList":{"description":"di event id list from di database\n"},"jobIdList":{"description":"job id list from transactional email job database\n"},"diJobIdList":{"description":"job id list from di email job database\n"}},"snippets":{"set_email_var":"set @email = \"{{email}}\";\n","set_email_var_unicode":"set @email = \"{{email}}\" COLLATE utf8_unicode_ci;\n","set_email_like_var":"set @email = \"%{{email}}%\";\n","find_user_id":"select uid into @UID from users where mail = @email;\n","show_user_id":"select @UID;\n","set_request_number_var":"set @requestnumber = \"{{requestNumber}}\";\n","set_user_id_var":"set @UID = {{userId}};\n","compose_email_placeholder":"select concat(\"deleted-onetrust-req-\", @requestnumber, \"@privacy.mntd.net\") into @emailplaceholder;\n","compose_text_placeholder":"select concat(\"Deleted per onetrust\", @requestnumber) into @textplaceholder;\n","update_placeholder_in_users":"update users\nset\nname = @textplaceholder,\ninit = @textplaceholder,\nmail = @emailplaceholder,\npass = @textplaceholder\nwhere uid = @UID;\n","find_sessions":"select * from sessions where uid = @UID;\n","find_friend_email_id_list":"select group_concat(id) from friend_email where email = @email;\n","find_friend_address":"select * from friend_address \nwhere id in (\n  select friend_address_id from friend_email \n  where id in ({{friendEmailIdList}})\n);\n","find_minted_account":"select * from minted_account where user_id = @UID;\n","find_minted_order_incomplete":"select *\nfrom minted_order\nwhere owner_id = @UID\nand is_placed = 1\nand minted_state_diagram_state_id <> 150;\n","find_minted_order_complete_within_3_months":"select *\nfrom minted_order\nwhere owner_id = @UID\nand is_placed = 1\nand minted_state_diagram_state_id = 150\nand date_add(order_placement_date, interval 3 month) >= now();\n","find_minted_order_digital":"select moli.*\nfrom minted_order mo\ninner join minted_order_line_item moli\non mo.id = moli.minted_order_id\nand moli.line_item_type = 'product'\nwhere owner_id = @UID\nand is_placed = 1\nand minted_state_diagram_state_id = 150\nand date_add(order_placement_date, interval 3 month) >= now();\n","find_minted_order_complete_3_months_before":"select group_concat(id)\nfrom minted_order\nwhere owner_id = @UID\nand \n((is_placed = 1\nand minted_state_diagram_state_id = 150\nand date_add(order_placement_date, interval 3 month) < now())\nor (is_placed = 0));\n","find_minted_order_line_item":"select * from minted_order_line_item moli\ninner join minted_order mo\non moli.minted_order_id = mo.id\nwhere owner_id = @UID\nand\n((is_placed = 1\nand minted_state_diagram_state_id = 150\nand date_add(order_placement_date, interval 3 month) < now())\nor (is_placed = 0));\n","find_price_adjustment_note":"select * from minted_order mo\ninner join price_adjustment_note pan\non mo.id = pan.order_id\nwhere owner_id = @UID;\n","find_payment_information":"select * from payment_information where user_id = @UID;\n","find_minted_address":"select * from minted_address where user_id = @UID;\n","find_di_unsubscribe_host":"select id into @diunsubscribehostid\nfrom di_unsubscribe\nwhere host_email = @email;\n","show_di_unsubscribe_host_id":"select @diunsubscribehostid;\n","find_di_unsubscribe_guest":"select id into @diunsubscribeguestid\nfrom di_unsubscribe\nwhere guest_email = @email;\n","show_di_unsubscribe_guest_id":"select @diunsubscribeguestid;\n","find_di_invitation_id_list":"select group_concat(id)\nfrom di_invitation where email = @email;\n","find_di_event_poll_question_response":"select * \nfrom di_event_poll_question_response\nwhere di_invitation_id in ({{diInvitationIdList}});\n","find_email_in_di_host_test_email":"select * \nfrom di_host_test_email\nwhere email_address = @email;\n","find_di_email_id_list_guest":"select group_concat(id)\nfrom di_email\nwhere email = @email;\n","find_di_event_id_list":"select group_concat(id) from di_event \nwhere creator_user_id = @UID;\n","find_di_email_host":"select *\nfrom di_email\nwhere di_event_id in ({{diEventIdList}});\n","find_di_event_attribute":"select * \nfrom di_event_attribute\nwhere di_event_id in ({{diEventIdList}});\n","find_di_event_comment":"select * \nfrom di_event_comment\nwhere di_event_id in ({{diEventIdList}});\n","find_di_event_message":"select * \nfrom di_event_message\nwhere di_event_id in ({{diEventIdList}});\n","find_di_event_poll_question":"select * \nfrom di_event_poll_question\nwhere di_event_id in ({{diEventIdList}});\n","find_di_event_update_event":"select * \nfrom di_event_update_event\nwhere di_event_id in ({{diEventIdList}});\n","find_event_id_in_di_host_test_email":"select * \nfrom di_host_test_email\nwhere di_event_id in ({{diEventIdList}});\n","find_di_media":"(select dm.* \nfrom di_event de\ninner join di_media dm\non de.rendered_card_media_id = dm.id\nwhere de.id in ({{diEventIdList}}))\nunion\n(select dm.* \nfrom di_host_test_email dhte\ninner join di_media dm\non dhte.rendered_card_media_id = dm.id\nwhere di_event_id in ({{diEventIdList}}))\nunion\n(select dm.* \nfrom di_host_test_email dhte\ninner join di_media dm\non dhte.rendered_text_media_id = dm.id\nwhere di_event_id in ({{diEventIdList}}))\nunion\n(select dm.* \nfrom di_host_test_email dhte\ninner join di_media dm\non dhte.rendered_email_composite_media_id = dm.id\nwhere di_event_id in ({{diEventIdList}}))\nunion\n(select dm.* \nfrom di_invitation di\ninner join di_media dm\non di.rendered_text_media_id = dm.id\nwhere di_event_id in ({{diEventIdList}}))\nunion\n(select dm.* \nfrom di_invitation di\ninner join di_media dm\non di.rendered_email_composite_media_id = dm.id\nwhere di_event_id in ({{diEventIdList}}));\n","find_job_id_for_email_in_job":"select group_concat(id) from job \nwhere arguments like @email;\n","delete_sessions":"delete from sessions where uid = @UID;\n","update_placeholder_in_friend_email":"update friend_email\nset\ndisplay_name = @textplaceholder,\nemail = @emailplaceholder,\nname = @textplaceholder\nwhere id in ({{friendEmailIdList}});\n","update_placeholder_in_minted_account":"update minted_account\nset \nfirst_name = @textplaceholder,\nlast_name = @textplaceholder,\nphone = @textplaceholder,\nbirthday = NULL,\nwedding_anniversary = NULL,\nlocation = @textplaceholder,\ngender = NULL\nwhere user_id = @UID;\n","update_placeholder_in_minted_order":"update minted_order\nset\ncc_name = @textplaceholder,\ngift_message = @textplaceholder,\nspecial_instructions = NULL,\ncalculated_country_code = '',\ncalculated_region = ''\nwhere id in ({{mintedOrderIdList}});\n","update_placeholder_in_minted_order_line_item":"update minted_order_line_item\nset shipping_tracking_number = @textplaceholder\nwhere minted_order_id in ({{mintedOrderIdList}});\n","find_thumbnail_url_in_minted_order_line_item":"select updated_thumbnail_url from minted_order_line_item\nwhere minted_order_id in ({{mintedOrderIdList}});\n","update_placeholder_in_price_adjustment_note":"update price_adjustment_note pan\ninner join minted_order mo\non mo.id = pan.order_id\nset note = @textplaceholder\nwhere mo.owner_id = @UID;\n","update_placeholder_in_payment_information":"update payment_information\nset payment_owner_name = @textplaceholder\nwhere user_id = @UID;\n","update_placeholder_in_minted_address":"update minted_address\nset\nfirst_name = @textplaceholder,\nlast_name = @textplaceholder,\nphone = @textplaceholder,\nzipcode = NULL,\naddress_name = @textplaceholder,\naddress1 = @textplaceholder,\naddress2 = @textplaceholder,\ncity = @textplaceholder,\ncountry = NULL,\nregion = @textplaceholder,\nstate = NULL\nwhere user_id = @UID;\n","update_placeholder_in_di_invitation":"update di_invitation\nset\nname = @textplaceholder,\nemail = @textplaceholder,\nnote = @textplaceholder\nwhere id in ({{diInvitationIdList}});\n","delete_di_email_as_guest":"delete from di_email\nwhere id in ({{diEmailIdList}});\n","delete_job_for_job_id_in_jobs":"delete from job\nwhere id in ({{jobIdList}});\n","delete_job_for_job_id_in_di_jobs":"delete from job\nwhere id in ({{diJobIdList}});\n","validate_friend_email_placeholder":"select * from friend_email\nwhere id in ({{friendEmailIdList}})\nand display_name = @textplaceholder\nand email = @emailplaceholder\nand name = @textplaceholder;\n","validate_users_placeholder":"select * from users\nwhere uid = @UID\nand name = @textplaceholder\nand init = @textplaceholder\nand mail = @emailplaceholder\nand pass = @textplaceholder;\n","validate_minted_account_placeholder":"select * from minted_account\nwhere user_id = @UID\nand first_name = @textplaceholder\nand last_name = @textplaceholder\nand phone = @textplaceholder\nand birthday IS NULL\nand wedding_anniversary IS NULL\nand location = @textplaceholder\nand gender IS NULL;\n","valdiate_minted_order_placeholder":"select * from minted_order\nwhere id in ({{mintedOrderIdList}})\nand cc_name = @textplaceholder\nand gift_message = @textplaceholder\nand special_instructions IS NULL\nand calculated_country_code = ''\nand calculated_region = '';\n","validate_minted_order_line_item_placeholder":"select * from minted_order_line_item\nwhere minted_order_id in ({{mintedOrderIdList}})\nand shipping_tracking_number = @textplaceholder;\n","validate_price_adjustment_note_placeholder":"select * from price_adjustment_note pan\ninner join minted_order mo\non mo.id = pan.order_id\nwhere mo.owner_id = @UID\nand note = @textplaceholder;\n","validate_payment_information_placeholder":"select * from payment_information\nwhere user_id = @UID\nand payment_owner_name = @textplaceholder;\n","validate_minted_address_placeholder":"select * from minted_address\nwhere user_id = @UID\nand first_name = @textplaceholder\nand last_name = @textplaceholder\nand phone = @textplaceholder\nand zipcode IS NULL\nand address_name = @textplaceholder\nand address1 = @textplaceholder\nand address2 = @textplaceholder\nand city = @textplaceholder\nand country IS NULL\nand region = @textplaceholder\nand state IS NULL;\n","validate_di_email_as_guest_deletion":"select * from di_email\nwhere id in ({{diEmailIdList}});\n","validate_di_invitation_placeholder":"select * from di_invitation\nwhere id in ({{diInvitationIdList}});\n"}},"aspect":"growth-ccpa-delete"}}
{"initialProps":{"appProps":{}},"initialState":{"scriptSnippet":{"ids":[],"entities":{}},"variable":{"ids":[],"entities":{}},"scriptType":[],"scriptDatabase":[],"choiceControl":{"ids":[],"entities":{}},"step":{"steps":{}},"databaseScript":{"scripts":{}},"notes":{"ids":[],"entities":{}},"scriptResult":{"ids":[],"entities":{}},"dependencyCheck":{"dependencyChecks":{}}},"__N_SSG":true,"pageProps":{"yamlData":{"steps":[{"id":"begin","check":{"script":{"db":"drupal","snippets":["set_email_var"]}},"delete":{"script":{"db":"drupal","snippets":["set_request_number_var","set_user_id_var","compose_email_placeholder","compose_text_placeholder"]}}},{"id":"users","check":{"description":"check if the email is in users table in bidata DB\n","script":{"db":"drupal","snippets":["set_email_var","find_user_id","show_user_id"]}},"delete":{"description":"create sql to \"delete\" in users table\n","script":{"db":"drupal","snippets":["update_placeholder_in_users"]}}},{"id":"sessions","check":{"description":"check if the user id is in sessions table in sessions DB\n","script":{"db":"sessions","snippets":["set_user_id_var","find_sessions"]}}},{"id":"friend_email","check":{"description":"check if the email is in friend_email table in bidata DB\n","script":{"db":"drupal","snippets":["set_email_var","find_friend_email_id","find_friend_email"]}}},{"id":"friend_address","check":{"description":"check if the friend email id is in friend_address table in bidata DB\n","script":{"db":"drupal","snippets":["set_email_var","find_friend_email_id","find_friend_address_id","find_friend_address"]}}},{"id":"minted_account","check":{"description":"check if the user id is in minted_account table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_account"]}}},{"id":"minted_order_incomplete","check":{"description":"check if the user id is in minted_order table in bidata DB and  order has been placed and NOT completed\n","choices":[{"id":"yes","notes":"TODO: We need to wait for the order to be completed  before we delete data\n"},{"id":"no"}],"script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_incomplete"]}}},{"id":"minted_order_complete_within_3_months","check":{"description":"check if the user id is in minted_order table in bidata DB and  order has been placed, completed, and not passed the return policy,  3 months after purchase\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_complete_within_3_months"]}}},{"id":"minted_order_digital","check":{"dependency":{"stepId":"minted_order_complete_within_3_months","choice":"yes","type":"check"},"description":"check if the minted_order_line_item is digital\n","choices":[{"id":"yes"},{"id":"no","notes":"TODO: We need to wait for the return policy to pass before we delete data\n"}],"script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_digital"]}}},{"id":"minted_order_complete_3_months_before","check":{"description":"check if the user id is in minted_order table in bidata DB and order has been placed, completed,  and passed the return policy, 3 months after purchase\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_complete_3_months_before"]}}},{"id":"minted_order_line_item","check":{"description":"check if the user id is in minted_order_line_item table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_order_line_item"]}}},{"id":"price_adjustment_note","check":{"description":"check if the user id is in price_adjustment_note table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_price_adjustment_note"]}}},{"id":"payment_information","check":{"description":"check if the user id is in payment_information table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_payment_information"]}}},{"id":"minted_address","check":{"description":"check if the user id is in minted_address table in bidata DB\n","script":{"db":"drupal","snippets":["set_user_id_var","find_minted_address"]}}},{"id":"di_unsubscribe_as_host","check":{"description":"check if the email is in di_unsubscribe table in DI DB as a host\n","script":{"db":"di","snippets":["set_email_var_unicode","find_di_unsubscribe_host","show_di_unsubscribe_host_id"]}}},{"id":"di_unsubscribe_as_guest","check":{"description":"check if the email is in di_unsubscribe table in DI DB as a guest\n","script":{"db":"di","snippets":["set_email_var_unicode","find_di_unsubscribe_guest","show_di_unsubscribe_guest_id"]}}},{"id":"di_invitation","check":{"description":"check if the invitation id is in di_invitation table in DI DB as a guest\n","script":{"db":"di","snippets":["set_email_var_unicode","find_di_invitation_id","find_di_invitation"]}}},{"id":"di_event_poll_question_response","check":{"description":"check if the invitation id is in di_event_poll_question_response table in DI DB as a guest\n","script":{"db":"di","snippets":["set_email_var_unicode","find_di_invitation_id","find_di_event_poll_question_response"]}}},{"id":"email_in_di_host_test_email","check":{"description":"check if the email is in di_host_test_email table in DI DB\n","script":{"db":"di","snippets":["set_email_var_unicode","find_email_in_di_host_test_email"]}}},{"id":"di_email_as_guest","check":{"description":"check if the event id is in di_email table in DI DB as a guest\n","script":{"db":"di","snippets":["set_email_var_unicode","find_di_email_guest"]}}},{"id":"di_email_as_host","check":{"description":"check if the event id is in di_email table in DI DB as a host\n","script":{"db":"di","snippets":["set_email_var_unicode","find_di_event_id","find_di_email_host"]}}},{"id":"di_event_as_host","check":{"description":"check if the user id is in di_event table in DI DB as a host\n","script":{"db":"di","snippets":["set_user_id_var","find_di_event_id","find_di_event"]}}},{"id":"di_event_attribute","check":{"description":"check if the event id is in di_event_attribute table in DI DB\n","script":{"db":"di","snippets":["set_user_id_var","find_di_event_id","find_di_event_attribute"]}}},{"id":"di_event_comment","check":{"description":"check if the event id is in di_event_comment table in DI DB\n","script":{"db":"di","snippets":["set_user_id_var","find_di_event_id","find_di_event_comment"]}}},{"id":"di_event_message","check":{"description":"check if the event id is in di_event_message table in DI DB\n","script":{"db":"di","snippets":["set_user_id_var","find_di_event_id","find_di_event_message"]}}},{"id":"di_event_poll_question","check":{"description":"check if the event id is in di_event_poll_question table in DI DB\n","script":{"db":"di","snippets":["set_user_id_var","find_di_event_id","find_di_event_poll_question"]}}},{"id":"di_event_update_event","check":{"description":"check if the event id is in di_event_update_event table in DI DB\n","script":{"db":"di","snippets":["set_user_id_var","find_di_event_id","find_di_event_update_event"]}}},{"id":"event_id_in_di_host_test_email","check":{"description":"check if the event id is in di_host_test_email table in DI DB\n","script":{"db":"di","snippets":["set_user_id_var","find_di_event_id","find_event_id_in_di_host_test_email"]}}},{"id":"di_media","check":{"description":"check if the event id is in di_media table in DI DB\n","script":{"db":"di","snippets":["set_user_id_var","find_di_event_id","find_di_media"]}}},{"id":"transactional_email","check":{"description":"check if the email is in transactional email jobs table\n","script":{"db":"jobs","snippets":["set_email_like_var","find_email_in_job"]}}},{"id":"di_jobs","check":{"description":"check if the email is in DI jobs table\n","script":{"db":"di_jobs","snippets":["set_email_like_var","find_email_in_job"]}}}],"types":["check","delete","Validation"],"db":["drupal","sessions","di","jobs","di_jobs"],"vars":{"email":{"description":"email address from OneTrust\n"},"requestNumber":{"description":"request number from OneTrust\n"},"userId":{"description":"user id from the main drupal database\n"},"emailPlaceholder":{"description":"placeholder to replace email reference\n"},"textPlaceholder":{"description":"placeholder to replace text reference\n"}},"snippets":{"set_email_var":"set @email = \"{{email}}\";\n","set_email_var_unicode":"set @email = \"{{email}}\" COLLATE utf8_unicode_ci;\n","set_email_like_var":"set @email = \"%{{email}}%\";\n","find_user_id":"select uid into @UID from users where mail = @email;\n","show_user_id":"select @UID;\n","set_request_number_var":"set @requestnumber = \"{{requestNumber}}\";\n","set_user_id_var":"set @UID = {{userId}};\n","compose_email_placeholder":"select concat(\"deleted-onetrust-req-\", @requestnumber, \"@privacy.mntd.net\") into @emailplaceholder;\n","compose_text_placeholder":"select concat(\"Deleted per onetrust\", @requestnumber) into @textplaceholder;\n","update_placeholder_in_users":"update users\nset\nname = @textplaceholder,\ninit = @textplaceholder,\nmail = @emailplaceholder,\npass = textplaceholder,\nwhere uid = @UID;\n","find_sessions":"select * from sessions where uid = @UID;\n","find_friend_email_id":"select id into @friendemailid from friend_email where email = @email;\n","find_friend_email":"select * from friend_email where id = @friendemailid;\n","find_friend_address_id":"select friend_address_id into @friend_address_id\nfrom friend_email where id = @friendemailid;\n","find_friend_address":"select * from friend_address where id = @friendaddressid;\n","find_minted_account":"select * from minted_account where user_id = @UID;\n","find_minted_order_incomplete":"select *\nfrom minted_order\nwhere owner_id = @UID\nand is_placed = 1\nand minted_state_diagram_state_id <> 150;\n","find_minted_order_complete_within_3_months":"select *\nfrom minted_order\nwhere owner_id = @UID\nand is_placed = 1\nand minted_state_diagram_state_id = 150\nand date_add(order_placement_date, interval 3 month) >= now();\n","find_minted_order_digital":"select moli.*\nfrom minted_order mo\ninner join minted_order_line_item moli\non mo.id = moli.minted_order_id\nand moli.line_item_type = 'product'\nwhere owner_id = @UID\nand is_placed = 1\nand minted_state_diagram_state_id = 150\nand date_add(order_placement_date, interval 3 month) >= now();\n","find_minted_order_complete_3_months_before":"select *\nfrom minted_order\nwhere owner_id = @UID\nand \n((is_placed = 1\nand minted_state_diagram_state_id = 150\nand date_add(order_placement_date, interval 3 month) < now())\nor (is_placed = 0));\n","find_minted_order_line_item":"select * from minted_order_line_item moli\ninner join minted_order mo\non moli.minted_order_id = mo.id\nwhere owner_id = @UID\nand\n((is_placed = 1\nand minted_state_diagram_state_id = 150\nand date_add(order_placement_date, interval 3 month) < now())\nor (is_placed = 0));\n","find_price_adjustment_note":"select * from minted_order mo\ninner join price_adjustment_note pan\non mo.id = pan.order_id\nwhere owner_id = @UID;\n","find_payment_information":"select * from payment_information where user_id = @UID;\n","find_minted_address":"select * from minted_address where user_id = @UID;\n","find_di_unsubscribe_host":"select id into @diunsubscribehostid\nfrom di_unsubscribe\nwhere host_email = @email;\n","show_di_unsubscribe_host_id":"select @diunsubscribehostid;\n","find_di_unsubscribe_guest":"select id into @diunsubscribeguestid\nfrom di_unsubscribe\nwhere guest_email = @email;\n","show_di_unsubscribe_guest_id":"select @diunsubscribeguestid;\n","find_di_invitation_id":"select id into @diinvitationid\nfrom di_invitation where email = @email;\n","find_di_invitation":"select * from di_invitation where id = @diinvitationid;\n","find_di_event_poll_question_response":"select * \nfrom di_event_poll_question_response\nwhere di_invitation_id = @diinvitationid;\n","find_email_in_di_host_test_email":"select * \nfrom di_host_test_email\nwhere email_address = @email;\n","find_di_email_guest":"select *\nfrom di_email\nwhere email = @email;\n","find_di_event_id":"select id into @dieventid\nfrom di_event \nwhere creator_user_id = @UID;\n","find_di_event":"select * from di_event where id = @dieventid;\n","find_di_email_host":"select *\nfrom di_email\nwhere di_event_id = @dieventid;\n","find_di_event_attribute":"select * \nfrom di_event_attribute\nwhere di_event_id = @dieventid;\n","find_di_event_comment":"select * \nfrom di_event_comment\nwhere di_event_id = @dieventid;\n","find_di_event_message":"select * \nfrom di_event_message\nwhere di_event_id = @dieventid;\n","find_di_event_poll_question":"select * \nfrom di_event_poll_question\nwhere di_event_id = @dieventid;\n","find_di_event_update_event":"select * \nfrom di_event_update_event\nwhere di_event_id = @dieventid;\n","find_event_id_in_di_host_test_email":"select * \nfrom di_host_test_email\nwhere di_event_id = @dieventid;\n","find_di_media":"(select dm.* \nfrom di_event de\ninner join di_media dm\non de.rendered_card_media_id = dm.id\nwhere de.id = @dieventid)\nunion\n(select dm.* \nfrom di_host_test_email dhte\ninner join di_media dm\non dhte.rendered_card_media_id = dm.id\nwhere di_event_id = @dieventid)\nunion\n(select dm.* \nfrom di_host_test_email dhte\ninner join di_media dm\non dhte.rendered_text_media_id = dm.id\nwhere di_event_id = @dieventid)\nunion\n(select dm.* \nfrom di_host_test_email dhte\ninner join di_media dm\non dhte.rendered_email_composite_media_id = dm.id\nwhere di_event_id = @dieventid)\nunion\n(select dm.* \nfrom di_invitation di\ninner join di_media dm\non di.rendered_text_media_id = dm.id\nwhere di_event_id = @dieventid)\nunion\n(select dm.* \nfrom di_invitation di\ninner join di_media dm\non di.rendered_email_composite_media_id = dm.id\nwhere di_event_id = @dieventid);\n","find_email_in_job":"select * from job \nwhere arguments like @email;\n"}},"aspect":"growth-ccpa-delete"}}